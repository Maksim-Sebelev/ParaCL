module;

//--------------------------------------------------------------------------------------------------------------------------------------

#include <concepts>
#include <stdexcept>
#include <memory>
#include <cstddef>
#include <string>
#include <string_view>
#include <type_traits>
#include <vector>
#include <memory>
#include <iostream>
#include <filesystem>

//--------------------------------------------------------------------------------------------------------------------------------------

export module ast;

//--------------------------------------------------------------------------------------------------------------------------------------

export import node_type_erasure;
import ast_nodes;
import write_ast;

//--------------------------------------------------------------------------------------------------------------------------------------


namespace ParaCL::ast
{

//--------------------------------------------------------------------------------------------------------------------------------------

export
class AST
{
private:
    node::BasicNode root_; /* global scope */
public:    
    AST() = default;

    AST(node::BasicNode&& root) :
        root_(root)
    {}

    AST(const std::filesystem::path& file);

public:
    node::BasicNode const &root() const noexcept
    { return root_; }
};

//--------------------------------------------------------------------------------------------------------------------------------------

AST::AST(const std::filesystem::path& file)
{
}

//--------------------------------------------------------------------------------------------------------------------------------------

export
void write(AST const & ast, std::filesystem::path const &file)
{
    std::ofstream ofs{file};
    write(ast.root(), ofs, 0);
}

//------------------------------------------------------------------------------------------------------------------------------------

} /* namespace ParaCL::ast */

//--------------------------------------------------------------------------------------------------------------------------------------
